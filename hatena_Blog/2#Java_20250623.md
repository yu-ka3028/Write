動的型付け言語から、Javaの「型」とinstanceof演算子につまずいた

# 背景
ポリモーフィズムを理解する際に一番詰まったのがinstanceof演算子で出てきた「型」と言う言葉だった。
動的型付け言語しか触ったことのなかった私には「型」と聞くと文字型や整数型といった基本型の印象しかなく、読んで理解した気になっていた参照型を「型」としてアップデートできてなかったんだ...。
そのためinstanceof演算子で文字型を指定し確認してどうするのかと頭を巡らせていました...苦笑

# 前提知識
- 継承には方向がある
  1. アップキャスト
    - サブクラスのインスタンスをスーパークラス型の変数に代入
    - 参照の自動型変換により明示的なキャスト不要でアクセス可能
  2. ダウンキャスト
    - スーパークラス型として参照している変数を、サブクラス型として扱う（キャストする）
    - 参照の自動型変換は型安全を保つため行われないため、明示的にキャストが必要
    - キャスト演算子は強制的に型変換するため、使用前に型安全を保った変換ができるかinstanceof演算子で確認推奨
 
- 実体の型とは
  newで作成された中身を指す
  ```java
  Member m = new StudentMember();
  ```
  - mの「変数の型」はMember 
  - mの「実体の型」はStudentMember

- キャストの有効範囲
  キャストは一時的にその型としてアクセスするためのもので、有効範囲に注意
  ```java
  if (obj instanceof String) {
      String s = (String) obj; // sはこのifブロック内だけString型
      // ここでsはString型として使える
  }
  // ここではsは使えない（スコープ外）
  ```
  ifの外でも使いたい時
  ````java
  String s = null;
  if (obj instanceof String) {
      s = (String) obj;
  }
  // ここでsを使うことはできるが、objがStringでなければsはnullのまま
  ```

# 今週の学びポイント
- point1 基本型だけじゃない、参照型の存在をしっかり認知
- point2 instanceof演算子とは
- point3 ポリモーフィックなオブジェクトとは

## 《Point1》基本型だけじゃない、参照型の存在をしっかり認知
```
型
├─ プリミティブ型
│   ├─ 整数型: byte, short, int, long
│   ├─ 浮動小数点型: float, double
│   ├─ 文字型: char
│   └─ 論理型: boolean
└─ 参照型
    ├─ クラス型: String, LocalDate など
    ├─ 配列型
    ├─ インターフェース型
    ├─ record型
    └─ enum型
```
- プリミティブ型は変数の型と実体の型が常に一致し、「型が固定」
- 参照型は、変数の型と実体の方が異なる場合があり、「実体の型が動的に変わる」
今までrubyやphpで使用していたのはプリミティブ型(基本型)中心だったみたい。
型ってintやchar以外にもあったんだ...。
本を読む中でへぇ〜参照型ね、ふむふむ・・・と読んでいたはずなんだよな...
型と呼ばれるものにプリミティブ型と参照型がある、という大枠を理解できて位いなかったんだな〜

あれ、ってことはinstanceof演算子にプリミティブ型を指定するイメージで理解しようとしていたからしっくりこなかったのでは...??
## 《Point2》instanceof演算子とは
- できること
  ```変数 instanceof 型```で実体の型を調べる
  -> 変数が指定した型もしくは、そのサブクラス（または実装クラス Exec）の型が一致すればtrueを返し、安全にキャスト演算子が使える状態であると判断できる
  ```java
  if (obj instanceof String) {
    String s = (String) obj; // 安全にキャストできる
  }
  ```

- 目的
  ダウンキャストしたい時にキャスト演算子を安全に使えるか「型」をチェックする

なるほど！instanceof演算子は宣言された型（変数の型、参照の型）と実体の型（インスタンスの型）が一致した場合trueを返すから、そもそも変数の型と実体の型が同一であるプリミティブ型で使う意味がないんだ！

## 《Point3》ポリモーフィックなオブジェクトとは
「実体の型」と「変数の型」が異なる状態で、多様な振る舞いができるオブジェクト指向の特徴のひとつ。
宣言型（スーパークラスやインタフェース）は同じでも、実体の型（それぞれのサブクラスや実装クラス）ごとに振る舞いを変えられることを「多態性（ポリモーフィズム）」と呼ぶ。
- ポリモーフィズムにより実現すること
静的型付け言語では変数の宣言型が固定されるが、アップキャストやダウンキャストによる型変換を活用することで、共通の宣言型でさまざまな実体（サブクラスや実装クラス）を扱える。
- オーバーライドでメソッドの上書きをすることで、同じメソッド呼び出しでも実体ごとに異なる動作が可能

# 振り返り
このブログを書き始めたタイミングでは、ポリモーフィックなオブジェクトとはという問いに対して「型」「継承」などをどう繋げればいいか正直曖昧な理解だったので、まさに今入れました！の知識でまとめてみたポリモーフィズムを近い将来読み返した時どう思うんだろうな...。
...という備忘録的な感覚で今週も書いてみました。

# 参考資料
- 新わかりやすい Java オブジェクト指向徹底解説（1-11 章 / 25 章）
